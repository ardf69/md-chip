<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-styles/color.html">
<link rel="import" href="../paper-styles/default-theme.html">
<link rel="import" href="../paper-styles/shadow.html">
<link rel="import" href="../paper-styles/typography.html">


<link rel="import" href="./md-chip-item.html">

<!--
    Material design: [Chips](https://material.google.com/components/chips.htm)

    The `<mad-chip>` implements the material design single line chip.
-->
<dom-module id="md-contact-chip">
    <template>
        <style>
            :host {
                display: inline-block;
            }

            #container {
                display: inline-block;
                @apply(--layout-horizontal);
                @apply(--layout-center);
                background-color: var(--md-chip-background-color, --divider-color);
                border-radius: 16px;
                box-sizing: border-box;
                color: var(--md-chip-color, --secondary-text-color);
                height: 32px;
                width: auto;
            }
            #container:hover {
                background-color: var(--md-chip-background-color-hover, --secondary-text-color);
                color: var(--md-chip-color-hover, --primary-background-color);
            }
            #empty {
                display: inline-block;
                width: 12px;
            }
            #label {
                font: var(--paper-font-menu);
            }
            #remove {
                padding-left: 4px;
                padding-right: 4px;
            }
        </style>

        <div>
            <div id="container">
                <template is="dom-if" if="[[_image]]">
                    <template is="dom-if" if="[[_isImage()]]">
                    </template>
                    <template is="dom-if" if="[[!_isImage()]]">
                    </template>
                </template>
                <template is="dom-if" if="[[!_image]]">
                    <div id="empty">&nbsp;</div>
                </template>
                <template is="dom-if" if="[[_label]]">
                    <div id="label">[[_label]]</div>
                </template>
                <template is="dom-if" if="[[removable]]">
                    <iron-icon id="remove" icon="cancel" on-tap="_remove"></iron-icon>
                </template>
                <template is="dom-if" if="[[!removable]]">
                    <div id="empty"></div>
                </template>
            </div>
        </div>
    </template>

    <script>
        (function () {
            'use strict';

            Polymer({

                is: 'md-chip',

                properties: {
                    _image: {
                        type: String,
                        value: null
                    },
                    _label: {
                        type: String,
                        value: null
                    },
                    removable: {
                        type: Boolean,
                        value: false
                    }
                },

                attached: function() {
                    this._observer = Polymer.dom(this).observeNodes(this._childNodesChanged.bind(this));
                },
                attributeChanged: function(name, type) {
                },
                detached: function() {
                    Polymer.dom(this).unobserveNodes(this._observer);
                },
                ready: function() {
                },


                _childNodesChanged: function(info) {
                    var self = this;

                    info.addedNodes.forEach(function (node) {
                        if (node.localName == 'md-chip-item') {
                            self.listen(node, 'image-changed', '_refresh()');
                            self.listen(node, 'label-changed', '_refresh()');
                        }
                    });
                    info.removedNodes.forEach(function (node) {
                        if (node.localName == 'md-chip-item') {
                            self.unlisten(node, 'image-changed', '_refresh()');
                            self.unlisten(node, 'label-changed', '_refresh()');
                        }
                    });
                    this._refresh();
                },
                _isImage: function() {
                    return this._image !== null && this._image !== undefined && this._image.length > 0;
                },
                _refresh: function() {
                    var items = this.queryAllEffectiveChildren('md-chip-item');

                    if (items.length) {
                        this._image = items[0].image;
                        this._label = items[0].label;
                    } else {
                        this._image = null;
                        this._label = null;
                    }
                },
                _remove: function() {
                    this.fire('remove', { value: this.label });
                },
            });
        })();
    </script>
</dom-module>
